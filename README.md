# Async log watcher

`async_log_watcher` is a simple Rust library developed as a part of a personal project. It is designed to monitor log files and trigger an async callback whenever a new line is added to the file. The library allows users to easily integrate log file monitoring into their projects, with support for monitoring multiple log files simultaneously.

The primary motivation behind creating this library was to efficiently detect new log lines generated by tools like `pm2`. The library is built using the `async-std` runtime and the `notify` crate for file system event monitoring.

## Usage

Add `async-log-watcher` to your `Cargo.toml` dependencies:

```toml
[dependencies]
async-log-watcher= "0.1.0"
```

### Example

```rust
use async_log_watcher::LogWatcher;
use async_std::task;

#[async_std::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    let mut log_watcher = LogWatcher::new();

    let filepath = "/path/to/log-out.txt";
    log_watcher
        .register(filepath, |line: String| {
            async move {
                println!("New log line: {}", line);
           }
        })
        .await;

    log_watcher.monitoring().await?;
    Ok(())
}
```

## TODO
- [x] Implement basic log monitoring.
- [x] Support async callbacks
- [x] Allow monitoring multiple log files simultaneously
- [X] Update with new version of dependencies.
- [x] FIX: When convert into absolute filepath, tilde('~') is used as folder name.
- [ ] FIX: At the first time, watcher read the first line.
- [ ] Add log::trace

## Future Works

- Add error handling for file read errors 
- Add support for log file rotation 
- Add database to store the last line number. 
- Implement a more efficient log file monitoring mechanism
- Add filtering options to process specific log lines based on patterns

## License

This project is licensed under the MIT License - see the [LICENSE](./LICENSE) file for details.
