# Async log watch

`async_log_watch` is a simple Rust library developed as a part of a personal project. It is designed to monitor log files and trigger an async callback whenever a new line is added to the file. The library allows users to easily integrate log file monitoring into their projects, with support for monitoring multiple log files simultaneously.

The primary motivation behind creating this library was to efficiently detect new log lines generated by tools like `pm2`. The library is built using the two async-runtime (`tokio` and `async-std`) and the `notify` crate for file system event monitoring.


## Usage

Add `async-log-watch` to your `Cargo.toml` dependencies:

```toml
[dependencies]
async-log-watch = {version = "0.1", features = ["async-std-runtime"]}
```

### Example

```rust
use async_log_watch::{LogWatcher, LogError};

#[async_std::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    let mut log_watcher = LogWatcher::new();

    let filepath = "~/.pm2/logs/r1-out.log";
    log_watcher
        .register(filepath, |line: String, err: Option<LogError>| async move {
            if err.is_none() {
                println!("New log line: {}", line);
            } else {
                eprintln!("{}", err.unwrap());
            }
        })
        .await;

    log_watcher
        .monitoring(std::time::Duration::from_secs(1))
        .await?;
    Ok(())
}

```

## TODO
- [x] Implement basic log monitoring.
- [x] Support async callbacks
- [x] Allow monitoring multiple log files simultaneously
- [X] Update with new version of dependencies.
- [x] FIXED: When convert into absolute filepath, tilde('~') is used as folder name.
- [x] FIXED: At the first time, watcher read the first line.
- [x] Error handling for file read errors
- [x] Improve error handling with the `thiserror` library. - file errors occurs in spawn. 
- [x] Notify error through callback

**~~Add support for log file rotation~~** (decided not to add support)
- [x] Added methods : stop_monitoring_file and change_file_path
- [x] FIXED: absolute path in added methods | test code 
- [ ] Update the callback function's arguments to include the functionalities.
	- It allows user to handle log file rotation in the callback function when receiving a file open error

- [x] Add support for other async runtimes (tokio)
- [ ] FIX : test for tokio


## Future Works

- Add filtering options to process specific log lines based on patterns

## License

This project is licensed under the MIT License - see the [LICENSE](./LICENSE) file for details.
